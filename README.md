# The pipeline to estimate maximum growth rate of bacteria from ASVs

# Get genome fasta files from a tsv file generated by BLAST

This is a way to get genome data by genome id from a tsv file generated by BLAST. The tsv file contains information of the species id and the genomen hit ids. One example is provided in the repo. `sh` scripting is used to automate the downloading processes facilitated by the two tools `datasets` and `dataformat` from NCBI. The **parallel fetching** has been implemented. A job submission file is provided for the cluster usage.

## Install `datasets` and `dataformat` from NCBI

Follow the [link](https://www.ncbi.nlm.nih.gov/datasets/docs/v2/download-and-install/) to install these two tools. 


## Run `getgenome_parallel_uniformdb.sh`

Basically, what this script does is:

1. Extract the species label, e.g. c497da3b39f30aceede6bec3b03cd100 and the genome id, e.g. GB_GCA_905618805.1 from each line in the tsv file. One species label may have several genome ids, also called hits;

2. Generate folders for each genome id; Different ASVs may have the same match with the same genome. The repeated matched genome is downloaed once;

3. Run `datasets` to download the genome data package. Make sure `datasets` is in the same folder as the `sh` script. 

```
sh getgenome_parallel_uniformdb.sh
```

The package contains a bunch to information. See [here](https://www.ncbi.nlm.nih.gov/datasets/docs/v2/reference-docs/data-packages/genome/) for details. A fasta file is included in the package;

4. Unzip the downloaded data. 


## Run `getgenome_parallel.sh -number-of-cores -filename.tsv`

Basically, what this script does is as the same as `getgenome.sh`. The parallel processing is implemented via [GNU `parallel`](https://www.gnu.org/software/parallel/). Note that two arguments are needed to run this `sh` as follows, taking MacOS terminal as an example:

```bash
sh getgenome_parallel.sh -number-of-cores -filename.tsv
```

## Annotating genomes using [Prokka](https://github.com/tseemann/prokka)

The script is `prokka_genomes.sh`

It reads the genomes sequences `.fasta` file and annotates and output a bunch of files. See  [Prokka](https://github.com/tseemann/prokka) for more details.

Singluarity image of Prokka is used on Caltech HPC to install the package. 

The output files will be stored in "prokkaoutput" folder. The genome annotations will be stored in the folder named after the genome. 


## Caveats

1. Being tested on Linux. Running well on the Caltech cluster;


## Future work

1. Using [gRodon](https://github.com/jlw-ecoevo/gRodon2) to estimate the maximum growth rates.



# Historical scripts; **deprecated now**

## Run `getgenome.sh`

Basically, what this script does is:

1. Extract the species label, e.g. c497da3b39f30aceede6bec3b03cd100 and the genome id, e.g. GB_GCA_905618805.1 from each line in the tsv file. One species label may have several genome ids, also called hits;

2. Generate folders for species and the corresponding hits;

3. Run `datasets` to download the genome data package. Make sure `datasets` is in the same folder as the `sh` script. 

```
sh getgenome.sh
```

The package contains a bunch to information. See [here](https://www.ncbi.nlm.nih.gov/datasets/docs/v2/reference-docs/data-packages/genome/) for details. A fasta file is included in the package;

4. Unzip the downloaded data. 


## Run `getgenome_parallel.sh -number-of-cores -filename.tsv`

Basically, what this script does is as the same as `getgenome.sh`. The parallel processing is implemented via [GNU `parallel`](https://www.gnu.org/software/parallel/). Note that two arguments are needed to run this `sh` as follows, taking MacOS terminal as an example:

```bash
sh getgenome_parallel.sh -number-of-cores -filename.tsv
```


